{
  "start": {
    "action": "detect_car",
    "next": "detect_license_plate"
  },
  "detect_license_plate": {
    "action": "detect_plate",
    "condition": "check_plate_recognized()",
    "yes": "verify_plate_match",
    "no": "ask_spell_plate"
  },
  "ask_spell_plate": {
    "action": "say: Spell the license plate, please",
    "listen": true,
    "listen_for": "plate",
    "next": "ask_if_spell_plate_correct"
  },
  "ask_if_spell_plate_correct": {
    "action": "say: Is your license plate: {PLATE} correct? Please answer yes or no.",
    "listen": true,
    "listen_for": "confirmation",
    "condition": "plate_confirmed()",
    "yes": "verify_plate_match",
    "no": {
      "counter": "increment_failures",
      "condition": "failures >= 2",
      "yes": "say_call_operator",
      "no": "ask_spell_plate"
    }
  },
  "verify_plate_match": {
    "condition": "check_plate_recognized()",
    "yes": "check_payment_status",
    "no": {
      "counter": "increment_failures",
      "condition": "failures >= 2",
      "yes": "say_call_operator",
      "no": "ask_spell_plate"
    }
  },
  "check_payment_status": {
    "condition": "check_payment_status()",
    "yes": "open_barrier",
    "no": "check_totpai"
  },
  "check_totpai": {
    "condition": "NB_TOTPAI > 0",
    "yes": "check_time_diff",
    "no": "say_not_paid"
  },
  "check_time_diff": {
    "condition": "CUR_TIME - DHMP < N",
    "yes": "say_call_operator",
    "no": "say_time_expired"
  },
  "say_not_paid": {
    "action": "say: Your session is not paid. Please pay at the terminal.",
    "next": "dialogue_closed"
  },
  "say_time_expired": {
    "action": "say: You paid at DHMP. Free time is over, and you have to pay the new session at the terminal.",
    "next": "dialogue_closed"
  },
  "open_barrier": {
    "action": "open_barrier",
    "next": "dialogue_closed"
  },
    "say_call_operator": {
    "action": "say: Please wait, connecting to an operator.",
    "next": "call_operator"
  },
  "call_operator": {
    "action": "call_operator",
    "next": "dialogue_closed"
  },
  
  "dialogue_closed": {
    "action": "end"
  }
}
